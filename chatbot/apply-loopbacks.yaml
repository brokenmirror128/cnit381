---
  - name: Add lo# interfaces
    hosts: routers
    gather_facts: false
    connection: network_cli

    tasks:
      - name: Locate router ID per host
        ios_command:
                commands: show running-config | include router-id
        register: rid_raw

      - name: Format RID as single digit
        shell: echo {{ rid_raw }} | sed 's@^[^0-9]*\([0-9]\+\).*@\1@'
        register: rid

      - name: Loopback Interface Configuration
        ios_config:
           lines:
             - ip address 10.0.202.1 255.255.255.255
           parents:
             - int lo1
        when: "'1' in inventory_hostname"

      - name: Loopback for router 2
        ios_config:
           lines:
             - ip address 10.0.202.2 255.255.255.255
           parents:
             - int lo1
        when: "'2' in inventory_hostname"
